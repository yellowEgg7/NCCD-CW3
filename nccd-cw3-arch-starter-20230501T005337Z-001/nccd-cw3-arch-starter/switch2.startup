ip addr add 172.16.1.5/21 dev eth0
ip link set up dev eth0 

ip addr add 10.16.0.0/16 dev eth1
ip link set up dev eth1

ip route add 10.0.0.0/21 via 10.16.0.1
ip route add 172.16.0.0/21 via 10.16.0.2
ip route add 192.18.0.0/31 via 10.16.0.3

ip route add default via 10.16.0.4

#DMZ filters between zones of trust

# Allow incoming HTTP traffic (port 80)
iptables -A INPUT -p tcp --dport 80 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT

# Allow incoming HTTPS traffic (port 443)
iptables -A INPUT -p tcp --dport 443 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT

# Allow incoming SMTP traffic (port 25)
iptables -A INPUT -p tcp --dport 25 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT

# Allow incoming DNS traffic (port 53)
iptables -A INPUT -p udp --dport 53 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT
iptables -A INPUT -p tcp --dport 53 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT

# Allow incoming HTTP traffic (port 80)
iptables -A INPUT -p tcp --dport 80 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT

# Allow incoming HTTPS traffic (port 443)
iptables -A INPUT -p tcp --dport 443 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT

# Allow incoming SMTP traffic (port 25)
iptables -A INPUT -p tcp --dport 25 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT

# Allow incoming DNS traffic (port 53)
iptables -A INPUT -p udp --dport 53 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT
iptables -A INPUT -p tcp --dport 53 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT

# Block incoming traffic from the DMZ to the internal subnet
iptables -A FORWARD -s 172.16.1.0/21 -d 10.0.0.0/21 -j DROP

# Block outgoing traffic from the DMZ to the internal subnet
iptables -A FORWARD -s 10.0.0.0/21 -d 172.16.1.0/21 -j DROP

# Block incoming traffic from the DMZ to the server subnet
iptables -A FORWARD -s 172.16.1.0/21  -d 172.16.0.0/21 -j DROP

# Block outgoing traffic from the DMZ to the server subnet
iptables -A FORWARD -s 172.16.0.0/21 -d 172.16.1.0/21  -j DROP